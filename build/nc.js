#!/usr/bin/env node
const shell = require('shelljs');

let argv = require('minimist')(process.argv.slice(2));
let dataset = argv['dataset'];
let googlea = argv['googlea'];
let port = argv['port'];

shell.echo(`
    +------------------------+
    | NC -- NetCreate Config |
    +------------------------+

    This script will select and load the Net.Create project in:

        /build/runtime/projectname.loki
        /build/runtime/projectname.template

    If 'projectname' does not exist, the script will create a new project.


    - - - - - - - - - -
    Starting script...

    1. Setting dataset to ${dataset}...`);


// dataset
if (dataset === undefined || dataset === '') {
  shell.echo(`
    **** ERROR: NO DATASET DEFINED ****

    Make sure you define a dataset with

        ./nc.js --dataset=projectname

    e.g. if you're trying to load "tacitus",
    the syntax is './nc.js --dataset=tacitus'\n
    `
  );
  shell.exit();
}


// google analytics
if (googlea === undefined || googlea === '') {
  shell.echo(`
    2. Google Analytics will not be used.
        Use the flag --googlea=XXXX to load google analyics for ID XXXX.
  `);
  googlea=0;
} else {
  shell.echo(`
    2. Using Google Analyics with:${googlea}.
        If you want to disable google analytics, leave this flag off or set to 0.
  `);
}


// port
if (port === undefined || port === '') {
  port = 3000;
}
shell.echo(`
    3. Setting port to ${port}
        Use './nc.js --port=xxxx' to define a diferent port.\n
`);


let script = `
// this file generated by NC command
const NC_CONFIG = {
  dataset: "${dataset}",
  port: "${port}",
  googlea: "${googlea}"
};
if (typeof process === "object") module.exports = NC_CONFIG;
if (typeof window === "object") window.NC_CONFIG = NC_CONFIG;`
let js = shell.ShellString(script).to('app/assets/netcreate-config.js');

shell.echo(`    4. Starting dev server...
\n
\n`);

shell.exec('npm run dev');
