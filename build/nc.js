#!/usr/bin/env node
const shell = require('shelljs');

let argv = require('minimist')(process.argv.slice(2));
let dataset = argv['dataset'];

shell.echo('');
shell.echo('    +------------------------+');
shell.echo('    | NC -- NetCreate Config |');
shell.echo('    +------------------------+');
shell.echo('');
shell.echo('    This script will select and load the Net.Create project in:');
shell.echo('');
shell.echo('        /build/runtime/projectname.loki');
shell.echo('        /build/runtime/projectname.template');
shell.echo('');
shell.echo('    If \'projectname\' does not exist, the script will create a new project.');
shell.echo('');
shell.echo('');
shell.echo('    - - - - - - - - - -');
shell.echo('    Starting script...');
shell.echo('');
shell.echo('    1. Setting dataset to "' + dataset + '"...');

if (dataset === undefined || dataset === '') {
  shell.echo('');
  shell.echo('    **** ERROR: NO DATASET DEFINED ****');
  shell.echo('');
  shell.echo('    Make sure you define a dataset with');
  shell.echo('');
  shell.echo('        ./nc.js --dataset=projectname');
  shell.echo('');
  shell.echo('    e.g. if you\'re trying to load "tacitus",');
  shell.echo('    the syntax is \'./nc.js --dataset=tacitus\'');
  shell.echo('');
  shell.exit();
}

let script = '';
script += '// this file generated by NC command\n';
script += 'const NC_CONFIG = {\n';
script += '  dataset: "' + dataset + '"\n';
script += '};\n';
script += 'if (typeof process === "object") module.exports = NC_CONFIG;\n';
script += 'if (typeof window === "object") window.NC_CONFIG = NC_CONFIG;\n';
let js = shell.ShellString(script).to('app/assets/netcreate-config.js');

shell.echo('    2. Starting dev server...');
shell.echo('');

shell.exec('npm run dev');
