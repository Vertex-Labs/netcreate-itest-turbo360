#!/usr/bin/env node
const shell = require('shelljs');

let argv = require('minimist')(process.argv.slice(2));
let dataset = argv['dataset'];

shell.echo(`
    +------------------------+
    | NC -- NetCreate Config |
    +------------------------+

    This script will select and load the Net.Create project in:

        /build/runtime/projectname.loki
        /build/runtime/projectname.template

    If 'projectname' does not exist, the script will create a new project.


    - - - - - - - - - -
    Starting script...

    1. Setting dataset to ${dataset}...`);

if (dataset === undefined || dataset === '') {
  shell.echo(`
    **** ERROR: NO DATASET DEFINED ****
  
    Make sure you define a dataset with
  
        ./nc.js --dataset=projectname
  
    e.g. if you're trying to load "tacitus",
    the syntax is './nc.js --dataset=tacitus'\n
    `
  );
  shell.exit();
}

let script = `
// this file generated by NC command
const NC_CONFIG = {
  dataset: "${dataset}"
};
if (typeof process === "object") module.exports = NC_CONFIG;
if (typeof window === "object") window.NC_CONFIG = NC_CONFIG;`
let js = shell.ShellString(script).to('app/assets/netcreate-config.js');

shell.echo(`    2. Starting dev server...
\n
\n`);

shell.exec('npm run dev');
